# ============================================
# ğŸš‚ NIXPACKS CONFIG - Railway Backend Build
# ============================================
# 
# Build optimisÃ© pour backend Node.js + Prisma
# Frontend dÃ©ployÃ© sÃ©parÃ©ment sur Vercel
#
# ============================================

[phases.setup]
nixPkgs = ["nodejs_20", "openssl", "postgresql"]

[phases.install]
cmds = [
  "npm ci --omit=dev",
  "npm install -g tsx prisma"
]

[phases.build]
cmds = [
  "npx prisma generate",
  "npm run build:server"
]

[start]
cmd = "npx prisma migrate deploy && npm run start:prod"

[variables]
NODE_ENV = "production"
